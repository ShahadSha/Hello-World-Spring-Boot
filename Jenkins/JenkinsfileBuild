pipeline {
  agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod
        metadata:
          labels:
            some-label: some-label-value
        spec:
          containers:
          - name: maven
            image: maven:alpine
            command:
            - cat
            tty: true
        '''
    }
  }
  tools {
    maven 'MAVEN_LOCAL'
  }
  stages {
    stage('Github Clone') {
      steps {
        checkout([$class: 'GitSCM', branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/ShahadSha/Hello-World-Spring-Boot']]]) 
      }
    }
    stage('SonarQube analysis') {
        steps {
            withSonarQubeEnv('sonarqube') { // You can override the credential to be used
                    sh 'mvn clean package sonar:sonar'
                } 
            
        }
    }
    stage("Quality Gate") {
            steps {
                timeout(time: 2, unit: 'MINUTES') {
                    waitForQualityGate abortPipeline: true
              }
          }
      }








  }
}
